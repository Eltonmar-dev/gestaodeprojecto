{% extends 'base.html' %}
{% block content %}
<div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">üìÅ Gest√£o Completa de Projetos</h1>
    <a href="/admin/gestao/projeto/add/" class="btn btn-primary shadow-sm">+ Novo Projeto</a>
</div>

<div class="relative overflow-x-auto shadow-md sm:rounded-lg border border-gray-200">
    <table class="w-full text-sm text-left text-gray-500">
        <thead class="text-xs text-white uppercase bg-gray-800">
            <tr>
                <th class="px-3 py-3">Identifica√ß√£o e Descri√ß√£o</th>
                <th class="px-3 py-3">Respons√°vel</th>
                <th class="px-3 py-3">Datas (In√≠cio/Fim)</th>
                <th class="px-3 py-3">Financeiro (Orc/Cust/Rec)</th>
                <th class="px-3 py-3 bg-gray-700">Lucro</th>
                <th class="px-3 py-3">Estado</th>
                <th class="px-3 py-3">Campos Personalizados (1-4)</th>
                <th class="px-3 py-3 text-center">A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for p in projetos %}
            <tr class="bg-white border-b hover:bg-blue-50 transition-colors">
                <td class="px-3 py-4">
                    <div class="font-bold text-gray-900">{{ p.nome }}</div>
                    <div class="text-xs text-gray-500 italic">{{ p.descricao|truncatewords:15 }}</div>
                </td>
                
                <td class="px-3 py-4 text-xs">
                    {{ p.responsavel.get_full_name|default:p.responsavel.username }}
                </td>

                <td class="px-3 py-4 text-xs">
                    <span class="block text-blue-600">In√≠cio: {{ p.data_inicio|date:"d/m/Y" }}</span>
                    <span class="block text-red-600">Fim: {{ p.data_fim|date:"d/m/Y" }}</span>
                </td>

                <td class="px-3 py-4 text-xs">
                    <div class="text-gray-400">Or√ß: {{ p.orcamento }}‚Ç¨</div>
                    <div class="text-red-500">Cust: {{ p.custos }}‚Ç¨</div>
                    <div class="text-green-600">Rec: {{ p.receita }}‚Ç¨</div>
                </td>

                <td class="px-3 py-4 font-bold bg-gray-50">
                    <span class="{% if p.lucro >= 0 %}text-blue-700{% else %}text-red-700{% endif %}">
                        {{ p.lucro }}‚Ç¨
                    </span>
                </td>

                <td class="px-3 py-4">
                    <span class="px-2 py-1 rounded text-[10px] font-bold uppercase 
                        {% if p.estado == 'CON' %} bg-green-200 text-green-800 
                        {% elif p.estado == 'AND' %} bg-yellow-200 text-yellow-800 
                        {% else %} bg-gray-200 text-gray-700 {% endif %}">
                        {{ p.get_estado_display }}
                    </span>
                </td>

                <td class="px-3 py-4 text-[11px] leading-tight">
                    <div class="mb-1"><b class="text-gray-700">C1:</b> {{ p.campo_custom_1|default:"-" }}</div>
                    <div class="mb-1"><b class="text-gray-700">C2:</b> {{ p.campo_custom_2|default:"-" }}</div>
                    <div class="mb-1"><b class="text-gray-700">C3:</b> {{ p.campo_custom_3|default:"-" }}</div>
                    <div><b class="text-gray-700">C4:</b> {{ p.campo_custom_4|default:"-"|truncatechars:20 }}</div>
                </td>

                <td class="px-3 py-4 text-center">
                    <div class="flex flex-col gap-1">
                        <a href="/admin/gestao/projeto/{{ p.id }}/change/" class="text-[10px] font-bold text-blue-600 hover:bg-blue-50 border border-blue-600 rounded px-2 py-1 uppercase">
                            Editar
                        </a>
                        <a href="{% url 'ocultar_projeto' p.id %}" class="text-[10px] font-bold text-yellow-600 hover:bg-yellow-50 border border-yellow-600 rounded px-2 py-1 uppercase">
                            Ocultar
                        </a>
                        <a href="{% url 'eliminar_projeto' p.id %}" 
                           onclick="return confirm('ATEN√á√ÉO: Deseja eliminar permanentemente este projeto?')" 
                           class="text-[10px] font-bold text-red-600 hover:bg-red-50 border border-red-600 rounded px-2 py-1 uppercase">
                            Eliminar
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}